<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AuraNexus</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Main Container -->
    <div class="app-container">
        
        <!-- Left Sidebar (Discord-style) -->
        <div class="sidebar">
            <div class="app-title">AuraNexus</div>
            
            <div class="modes-label">MODES</div>
            
            <button class="mode-btn active" data-mode="storyteller" onclick="switchMode('storyteller')">
                <span class="icon">üìñ</span> Storyteller
            </button>
            
            <button class="mode-btn" data-mode="assistant" onclick="switchMode('assistant')">
                <span class="icon">ü§ù</span> AI Assistant
            </button>
            
            <button class="mode-btn" data-mode="peer-specialist" onclick="switchMode('peer-specialist')">
                <span class="icon">üßò</span> Peer Specialist
            </button>
            
            <div class="spacer"></div>
            
            <button class="settings-btn" onclick="toggleSettings()">
                <span class="icon">‚öôÔ∏è</span> Settings
            </button>
            
            <button class="clear-btn" onclick="clearChat()">
                <span class="icon">üóëÔ∏è</span> Clear Chat
            </button>
            
            <div class="status">
                <div class="status-indicator" id="statusIndicator"></div>
                <span id="statusText">Checking backend...</span>
            </div>
        </div>
        
        <!-- Main Chat Area -->
        <div class="main-content">
            <!-- Chat Header -->
            <div class="chat-header">
                <h2 id="modeTitle">üí¨ AI Chatbot</h2>
                <p id="modeDescription">Have natural conversations with AI</p>
            </div>
            
            <!-- Messages Container -->
            <div class="messages" id="messagesContainer"></div>
            
            <!-- Input Area -->
            <div class="input-container">
                <input 
                    type="text" 
                    id="messageInput" 
                    placeholder="Type your message..."
                    onkeypress="handleKeyPress(event)"
                >
                <button id="sendBtn" onclick="sendMessage()">Send</button>
            </div>
        </div>
        
        <!-- Right Settings Panel (Collapsible) -->
        <div class="settings-panel" id="settingsPanel">
            <h3>‚öôÔ∏è Settings</h3>
            
            <!-- Model Selection (NEW) -->
            <div class="setting-group">
                <label>ü§ñ Model</label>
                <select id="modelSelect" onchange="onModelChange()">
                    <option value="">Loading models...</option>
                </select>
                <button class="refresh-btn" onclick="refreshModels()" title="Refresh model list">üîÑ</button>
            </div>
            
            <!-- System Prompt -->
            <div class="setting-group">
                <label>System Prompt</label>
                <textarea id="systemPrompt" rows="3" placeholder="You are Aura, a helpful AI assistant...">You are Aura, a friendly, helpful AI assistant. Keep answers concise.</textarea>
            </div>
            
            <!-- Agent Selection -->
            <div class="setting-group">
                <label>Agent</label>
                <select id="agentSelect">
                    <option value="narrator">Narrator</option>
                    <option value="character_1">Character 1</option>
                    <option value="character_2">Character 2</option>
                    <option value="director">Director</option>
                </select>
            </div>
            
            <!-- Sampling Presets -->
            <div class="setting-group">
                <label>Sampling Preset</label>
                <select id="samplingPreset" onchange="applySamplingPreset()">
                    <option value="custom">Custom</option>
                    <option value="balanced" selected>Balanced</option>
                    <option value="creative">Creative</option>
                    <option value="assistant">Assistant</option>
                    <option value="factual">Factual</option>
                </select>
            </div>
            
            <!-- Temperature -->
            <div class="setting-group">
                <label>Temperature</label>
                <input type="range" id="temperature" min="0" max="2" step="0.1" value="0.7" oninput="document.getElementById('tempValue').textContent = this.value">
                <span id="tempValue">0.7</span>
            </div>
            
            <!-- Max Tokens -->
            <div class="setting-group">
                <label>Max Tokens</label>
                <input type="number" id="maxTokens" min="50" max="4096" step="50" value="512">
            </div>
            
            <!-- Top-P -->
            <div class="setting-group">
                <label>Top-P (Nucleus Sampling)</label>
                <input type="range" id="topP" min="0" max="1" step="0.05" value="0.9" oninput="document.getElementById('topPValue').textContent = this.value">
                <span id="topPValue">0.9</span>
            </div>
            
            <!-- Top-K -->
            <div class="setting-group">
                <label>Top-K</label>
                <input type="number" id="topK" min="0" max="100" step="1" value="40">
            </div>
            
            <!-- Repeat Penalty -->
            <div class="setting-group">
                <label>Repeat Penalty</label>
                <input type="range" id="repeatPenalty" min="1.0" max="1.5" step="0.05" value="1.1" oninput="document.getElementById('repeatValue').textContent = this.value">
                <span id="repeatValue">1.1</span>
            </div>
            
            <!-- Target Sentences -->
            <div class="setting-group">
                <label>Target Sentences</label>
                <input type="number" id="targetSentences" min="1" max="20" step="1" value="3">
                <small style="color: #B5BAC1; font-size: 11px;">Auto-calculates max tokens (~35 tokens/sentence)</small>
            </div>
            
            <!-- Enter Sends Toggle -->
            <div class="setting-group">
                <label>
                    <input type="checkbox" id="enterSends" checked>
                    Enter Sends Message
                </label>
            </div>
            
            <!-- Voice/TTS Toggle -->
            <div class="setting-group">
                <label>
                    <input type="checkbox" id="voiceEnabled" checked>
                    Voice Enabled (TTS)
                </label>
            </div>
            
            <!-- Theme Selection -->
            <div class="setting-group">
                <label>Theme</label>
                <select id="themeSelect" onchange="applyTheme()">
                    <option value="dark" selected>Dark (Discord)</option>
                    <option value="midnight">Midnight</option>
                    <option value="solarized">Solarized Dark</option>
                    <option value="light">Light</option>
                </select>
            </div>
            
            <!-- UI Scale -->
            <div class="setting-group">
                <label>UI Scale</label>
                <input type="range" id="uiScale" min="12" max="22" step="1" value="14" oninput="document.getElementById('scaleValue').textContent = this.value + 'px'; applyUIScale(this.value)">
                <span id="scaleValue">14px</span>
            </div>
            
            <div class="setting-info">
                <h4>Current Mode</h4>
                <p id="currentModeInfo">AI Chatbot: Natural conversations with context awareness</p>
            </div>
        </div>
    </div>
    
    <script>
        console.log('Before app.js - __TAURI__:', typeof window.__TAURI__);
        console.log('Before app.js - window keys:', Object.keys(window).filter(k => k.includes('TAURI') || k.includes('tauri')));
    </script>
    <script src="app.js"></script>
</body>
</html>
